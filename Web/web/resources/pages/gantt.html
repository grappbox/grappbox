
<!-- This file is subject to the terms and conditions defined in file 'LICENSE.txt',
which is part of the GRAPPBOX source code package.
COPYRIGHT GRAPPBOX. ALL RIGHTS RESERVED. -->

<section id="gantt">

  <div data-ng-if="data.onLoad">
    <div class="spinner section">
      <svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></circle></svg>
    </div>
  </div>
  <div data-ng-if="!data.onLoad">
    <div data-ng-if="data.message == '_valid'">

      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            Options
          </h4>
        </div>
        <div class="panel-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-6 centered">
                <div class="form-group centered">
                  <h4>Date range</h4>
                  <div class="col-md-6">
                    <label class="control-label">From</label>
                    <input type="date" class="form-control" data-ng-model="options.fromDate" max-date="{{options.toDate}}" start-date="{{options.currentDateValue.toString()}}" start-week="1">
                  </div>
                  <div class="col-md-6">
                    <label class="control-label">To</label>
                    <input type="date" class="form-control" data-ng-model="options.toDate" min-date="{{options.fromDate}}" start-date="{{options.currentDateValue.toString()}}" start-week="1">
                  </div>
                </div>
              </div>
              <div class="col-md-6 centered">
                <div class="form-group centered">
                  <h4>Labels</h4>
                  <div class="radio-primary">
                    <label>
                      <input type="radio" name="labelsOptions" data-ng-model="options.labelsEnabled" data-ng-value="false">
                      Hidden
                    </label>
                  </div>
                  <div class="radio-primary">
                    <label>
                      <input type="radio" name="labelsOptions" data-ng-model="options.labelsEnabled" data-ng-value="true">
                      Visible
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 centered">
                <div class="form-group centered">
                  <h4>View scale</h4>
                  <div class="radio-primary">
                    <label>
                      <input type="radio" name="viewOptions" data-ng-model="options.width" data-ng-value="false">
                      Project overview
                    </label>
                  </div>
                  <div class="radio-primary">
                    <label>
                      <input type="radio" name="viewOptions" data-ng-model="options.width" data-ng-value="true">
                      Precise view
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-md-6 centered">
                <div class="form-group centered">
                  <h4>Containers</h4>
                  <a class="btn btn-raised" data-ng-click="expandAll()">Expand all</a>
                  <a class="btn btn-raised" data-ng-click="collapseAll()">Collapse all</a>
                  <a class="btn btn-raised" data-ng-click="reload()">Reload all</a>
                  <!-- <button class="btn btn-default btn-raised" data-ng-click="reload()">Refresh data</button> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- <textarea name="name" rows="8" cols="40">{[{data.gantt}]}</textarea> -->

      <div class="well">
        <div gantt
             data="data.gantt"
             show-side="options.labelsEnabled"
             daily="options.daily"
             filter-task="{'name': options.filterTask}"
             filter-row="{'name': options.filterRow}"
             sort-mode="options.sortMode"
             view-scale="options.scale"
             column-width="getColumnWidth(options.width, options.scale, options.zoom)"
             auto-expand="options.autoExpand"
             task-out-of-range="options.taskOutOfRange"
             from-date = "options.fromDate"
             to-date = "options.toDate"
             allow-side-resizing = "options.allowSideResizing"
             current-date="options.currentDate"
             current-date-value="options.currentDateValue"
             headers="options.width && options.shortHeaders || options.longHeaders"
             max-height="options.maxHeight && 300 || 0"
             api="options.api"
             column-magnet="options.columnMagnet">
            <gantt-tree enabled="true"
                        header-content="options.treeHeaderContent"
                        keep-ancestor-on-filter-row="true">
            </gantt-tree>
            <gantt-table enabled="true"
                         columns="options.treeTableColumns"
                         headers="options.columnsHeaders"
                         classes="options.columnsClasses"
                         formatters="options.columnsFormatters"
                         contents="options.columnsContents"
                         header-contents="options.columnsHeaderContents">
            </gantt-table>
            <gantt-groups enabled="true" display="options.groupDisplayMode"></gantt-groups>
            <gantt-tooltips></gantt-tooltips>
            <!-- <gantt-bounds></gantt-bounds> -->
            <gantt-progress></gantt-progress>
            <gantt-movable enabled="!options.readOnly"></gantt-movable>
            <gantt-draw-task
                enabled="options.canDraw"
                move-threshold="2"
                task-factory="options.drawTaskFactory">
            </gantt-draw-task>
            <!-- <gantt-overlap global="true"></gantt-overlap> -->
            <gantt-resize-sensor></gantt-resize-sensor>
            <gantt-dependencies enabled="options.dependencies" read-only="options.readOnly"></gantt-dependencies>
        </div><!-- !gantt -->
      </div>

    </div>
    <div data-ng-if="data.message == '_empty'" class="well">
      <div class="data-wrapper error">
        <p><i class="fa fa-frown-o"></i>No task for this project.</p>
      </div>
    </div>
    <div data-ng-if="data.message == '_invalid'" class="well">
      <div class="data-wrapper error">
        <p><i class="fa fa-times"></i>An error has occurred. Please try again.</p>
      </div>
    </div>
    <div data-ng-if="data.message == '_denied'" class="well">
      <div class="data-wrapper error">
        <p><i class="fa fa-times"></i>You don't have access to the tasks of this project.</p>
      </div>
    </div>
  </div>
</section>

<!-- gantt: task edition modal -->
<div>
  <script type="text/ng-template" id="modal_editTask.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelTaskEdition()">Ã—</button>
      <h4 class="modal-title">Task edition</h4>
    </div>
    <div class="modal-body">

      <md-tabs  md-border-bottom md-select="{[{tab.index}]}">
        <md-tab md-on-select="onTabSelected(1)">
          <md-tab-label>Task</md-tab-label>
          <md-tab-body>
            <form novalidate>
              <fieldset>
                <div class="form-group {[{ error.title ? 'has-error' : '' }]}">
                  <label for="edit-task-title" class="col-md-1 control-label">Title</label>
                  <div class="col-md-11">
                    <input type="text" class="form-control" id="edit-task-title" data-ng-model="data.edit.title" placeholder="Title">
                  </div>
                </div>
                <div class="form-group">
                  <label for="edit-task-description" class="col-md-1 control-label">Description</label>
                  <div class="col-md-11">
                    <textarea rows="4" class="form-control" id="edit-task-description" data-ng-model="data.edit.description" placeholder="Description"></textarea>
                  </div>
                </div>

                <div class="form-group" data-ng-if="data.edit.type == 'regular'">
                  <label for="edit-task-progress" class="col-md-1 control-label">Progress</label>
                  <div class="col-md-11">
                    <select id="edit-task-progress" class="form-control" data-ng-model="data.edit.advance" convert-to-number>
                      <option value="">None</option>
                      <option data-ng-repeat="n in [] | range:11" value="{[{$index*10}]}">{[{$index*10 + ' %'}]}</option>
                    </select>
                  </div>
                </div>

              </fieldset>
            </form>
          </md-tab-body>
        </md-tab>
        <md-tab md-on-select="onTabSelected(2)">
          <md-tab-label>Users</md-tab-label>
          <md-tab-body>Contant users tab</md-tab-body>
        </md-tab>
        <md-tab md-on-select="onTabSelected(3)">
          <md-tab-label>Dependencies</md-tab-label>
          <md-tab-body>Contant dependencies tab</md-tab-body>
        </md-tab>
      </md-tabs>

      <!-- <md-tabs md-selected="selectedIndex">
        <img ng-src="img/angular.png" class="centered">
        <md-tab ng-repeat="tab in tabs" md-on-select="onTabSelected(tab)" md-on-deselect="announceDeselected(tab)" ng-disabled="tab.disabled">
          <md-tab-label>
            {{tab.title}}
          </md-tab-label>
          <md-tab-body>
            {{tab.content}}
          </md-tab-body>
        </md-tab>
      </md-tabs> -->

    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmTaskEdition()">Update</button>
      <button type="button" class="btn" data-ng-click="modal_cancelTaskEdition()">Cancel</button>
    </div>
  </script>
</div>

</div>
