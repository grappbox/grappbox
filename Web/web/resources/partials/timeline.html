<!-- This file is subject to the terms and conditions defined in file 'LICENSE.txt',
which is part of the GRAPPBOX source code package.
COPYRIGHT GRAPPBOX. ALL RIGHTS RESERVED. -->

<!-- Timeline -->
<div class="page-header construction {[{ path.colors[path.current] + '-stripes' }]}">
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-padding text-center"><p><i class="material-icons">warning</i>This section is in construction.</p></div>
  <div class="clearfix"></div>
</div>

<section class="timeline">
<!--   <div class="page-header {[{ path.colors[path.current] + '-background' }]}">
 -->    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 no-padding text-center">
      <img src="../resources/img/app/statistics.min.png" width="300" height="auto" alt="Dashboard">
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 no-padding title">
      <h1>Discussions</h1>
      <p>This section allows you to communicate <strong>privately</strong> (to your team only), or with any registered customer.<br>You can also convert any topic to a GrappBox issue and use it in your project's bugtracker.</p>
    </div>
    <div class="clearfix"></div>
  </div>

<!-- timeline: tabs -->
<section id="timeline">
  <div class="row">
    <div class="col-lg-12">
      <div class="well well-soft">
        <!-- timeline: all tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li id="team-title" role="presentation" class="col-md-6 col-xs-12 {[{ timeline.team.active ? 'active' : '' }]}">
            <a href="" class="soft" role="tab" data-toggle="tab" data-ng-click="method.switchTab('team')">
              <i class="material-icons">group</i>Team members
            </a>
          </li>
          <li id="customer-title" role="presentation" class="col-md-6 col-xs-12 {[{ timeline.customer.active ? 'active' : '' }]}">
            <a href="" class="soft" role="tab" data-toggle="tab" data-ng-click="method.switchTab('customer')">
              <i class="material-icons">public</i>Customers
            </a>
          </li>
        </ul>
        <div class="tab-content">
          <!-- timeline: team tab -->
          <div role="tabpanel" class="tab-pane {[{ timeline.team.active ? 'active' : '' }]}">
            <div data-ng-if="timeline.team.onLoad">
              <div class="spinner section">
                <svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></circle></svg>
              </div>
            </div>
            <div data-ng-if="!timeline.team.onLoad">
              <div data-ng-if="view.authorized">
                <div data-ng-if="timeline.team.valid && timeline.team.messages" class="line">
                  <div class="each-data each-message col-md-6" data-ng-repeat="message in timeline.team.messages" data-ng-class-even="'even col-md-offset-6'" data-ng-class-odd="'odd'">
                    <div class="well no-shadow border">
                      <ul>
                        <li class="ellipsis"><strong>{[{ message.title }]}</strong><br>{[{ message.message }]}</li>
                        <li class="author">{[{ message.creator.firstname }]} {[{ message.creator.lastname }]}<br>{[{ method.formatObjectDate(message.createdAt) }]}<span data-ng-if="message.editedAt"> (edited on {[{ method.formatObjectDate(message.editedAt) }]})</span></li>
                      </ul>
                      <a href="" title="Open {[{ message.creator.fullname }]}'s message" data-ng-click="action.onOpenMessage(message)" class="btn btn-raised btn-info">Open</a>
                      <div class="clearfix"></div>
                    </div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div data-ng-if="!timeline.team.onLoad && timeline.team.valid && !timeline.team.messages">
                  <div class="error">
                    <p><i class="material-icons">speaker_notes_off</i><br>This timeline contains no messages.</p>
                  </div>
                </div>
                <div data-ng-if="!timeline.team.onLoad && !timeline.team.valid">
                  <div class="error">
                    <p><i class="material-icons">clear</i><br>An error has occurred. Please try again.</p>
                  </div>
                </div>
              </div>
              <div data-ng-if="!view.authorized">
                <div class="error">
                  <p><i class="material-icons">block</i><br>You don't have sufficient rights to perform this operation.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- timeline: customer tab -->
          <div role="tabpanel" class="tab-pane {[{ timeline.customer.active ? 'active' : '' }]}">
            <div data-ng-if="timeline.customer.onLoad">
              <div class="spinner section">
                <svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></circle></svg>
              </div>
            </div>
            <div data-ng-if="!timeline.customer.onLoad">
              <div data-ng-if="view.authorized">
                <div data-ng-if="timeline.customer.valid && timeline.customer.messages" class="line">
                  <div class="each-data each-message col-md-6" data-ng-repeat="message in timeline.customer.messages" data-ng-class-even="'even col-md-offset-6'" data-ng-class-odd="'odd'">
                    <div class="well no-shadow border">
                      <ul>
                        <li class="ellipsis"><strong>{[{ message.title }]}</strong><br>{[{ message.message }]}</li>
                        <li class="divider"></li>
                        <li class="author">{[{ message.creator.firstname }]} {[{ message.creator.lastname }]}<br>{[{ method.formatObjectDate(message.createdAt) }]}<span data-ng-if="message.editedAt"> (edited on {[{ method.formatObjectDate(message.editedAt) }]})</span></li>
                      </ul>
                      <a href="" title="Open {[{ message.creator.firstname }]}'s message" data-ng-click="action.onOpenMessage(message)" class="btn btn-raised btn-info">Open</a>
                      <div class="clearfix"></div>
                    </div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div data-ng-if="!timeline.customer.onLoad && timeline.customer.valid && !timeline.customer.messages">
                  <div class="error">
                    <p><i class="material-icons">speaker_notes_off</i><br>This timeline contains no messages.</p>
                  </div>
                </div>
                <div data-ng-if="!timeline.customer.onLoad && !timeline.customer.valid">
                  <div class="error">
                    <p><i class="material-icons">clear</i><br>An error has occurred. Please try again.</p>
                  </div>
                </div>
              </div>
              <div data-ng-if="!view.authorized">
                <div class="error">
                  <p><i class="material-icons">block</i><br>You don't have sufficient rights to perform this operation.</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<!-- timeline: new message fixed button -->
<section>
  <a href="" class="btn btn-danger btn-fab btn-fixed" title="Create a new message" data-ng-click="action.onNewMessage()" data-ng-if="view.authorized"><i class="material-icons">add</i></a>
</section>

<!-- timeline: message view modal -->
<div>
  <script type="text/ng-template" id="modal_openMessage.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_closeMessage()">×</button>
      <h4 class="modal-title">Message</h4>
    </div>
    <div class="modal-body">
      <div class="each-data message-data">
        <ul>
          <li><strong>{[{ active.message.title }]}</strong><br>{[{ active.message.message }]}</li>
          <li class="author">{[{ active.message.creator.firstname }]} {[{ active.message.creator.lastname }]}<br>{[{ method.formatObjectDate(active.message.createdAt) }]}<span data-ng-if="active.message.editedAt"> (edited on {[{ method.formatObjectDate(active.message.editedAt) }]})</span></li>
        </ul>
        <div class="action">
          <a href="" title="Delete this message" class="btn btn-default" data-ng-click="action.onDeleteMessage(active.message.id)" data-ng-if="user.id == active.message.creator.id">Delete</a>
          <a href="" title="Edit this message" class="btn" data-ng-click="action.onEditMessage(active.message)" data-ng-if="user.id == active.message.creator.id">Edit</a>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="each-data comments-data">
        <h4 class="modal-title">Comments</h4>
        <div data-ng-if="modal.onLoad">
          <div class="spinner section">
            <svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></circle></svg>
          </div>
        </div>
        <div data-ng-if="!modal.onLoad">
          <div data-ng-if="modal.authorized">
            <div data-ng-if="modal.valid && comments">
              <div class="each-data each-comment" data-ng-repeat="comment in comments">
                <div class="well well-soft no-shadow border">
                  <ul>
                    <li>{[{ comment.comment }]}</li>
                    <li class="author">{[{ comment.creator.firstname }]} {[{ comment.creator.lastname }]}<br>{[{ method.formatObjectDate(comment.createdAt) }]}<span data-ng-if="comment.editedAt"> (edited on {[{ method.formatObjectDate(comment.editedAt) }]})</span></li>
                  </ul>
                  <div class="action">
                    <a href="" title="Delete this comment" class="btn btn-default" data-ng-click="action.onDeleteComment(comment.id)" data-ng-if="user.id == comment.creator.id">Delete</a>
                    <a href="" title="Edit this comment" class="btn" data-ng-click="action.onEditComment(comment)" data-ng-if="user.id == comment.creator.id">Edit</a>
                  </div>
                  <div class="clearfix"></div>
                </div>
              </div>
            </div>
            <div data-ng-if="!modal.onLoad && modal.valid && !comments">
              <div class="error">
                <p><i class="material-icons">speaker_notes_off</i><br>No comments to display.</p>
              </div>
            </div>
            <div data-ng-if="!modal.onLoad && !modal.valid">
              <div class="error">
                <p><i class="material-icons">clear</i><br>An error has occurred. Please try again.</p>
              </div>
            </div>
          </div>
          <div data-ng-if="!modal.authorized">
            <div class="error">
              <p><i class="material-icons">block</i><br>You don't have sufficient rights to perform this operation.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" id="message-action">
      <a href="" title="Create a new issue from this message" class="btn btn-default" data-ng-click="action.onNewIssue(active.message)">Convert to issue</a>    
      <a href="" title="Add a comment" class="btn btn-info" data-ng-click="action.onNewComment(active.message)">Add comment</a> 
      <button type="button" title="Close this message" class="btn" data-ng-click="modal_closeMessage()">Close</button>
    </div>
  </script>
</div>

<!-- timeline: message creation modal -->
<div>
  <script type="text/ng-template" id="modal_createNewMessage.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelMessageCreation()">×</button>
      <h4 class="modal-title">Message creation</h4>
    </div>
    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="form-group {[{ error.title ? 'has-error' : '' }]}">
            <label for="new-message-title" class="col-md-1 control-label">Title</label>
            <div class="col-md-11">
              <input type="text" class="form-control" id="new-message-title" data-ng-model="new.message.title" placeholder="Title">
            </div>
          </div>
          <div class="form-group {[{ error.content ? 'has-error' : '' }]}">
            <label for="new-message-content" class="col-md-1 control-label">Message</label>
            <div class="col-md-11">
              <textarea class="form-control" rows="3" id="new-message-content" data-ng-model="new.message.message" placeholder="Message"></textarea>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmMessageCreation()">Create</button>
      <button type="button" class="btn" data-ng-click="modal_cancelMessageCreation()">Cancel</button>
    </div>
  </script>
</div>

<!-- timeline: comment creation modal -->
<div>
  <script type="text/ng-template" id="modal_createNewComment.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelCommentCreation()">×</button>
      <h4 class="modal-title">Comment creation</h4>
    </div>
    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="form-group {[{ error.content ? 'has-error' : '' }]}">
            <label for="new-comment-content" class="col-md-1 control-label">Message</label>
            <div class="col-md-11">
              <textarea class="form-control" rows="3" id="new-comment-content" data-ng-model="new.comment" placeholder="Message"></textarea>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmCommentCreation()">Create</button>
      <button type="button" class="btn" data-ng-click="modal_cancelCommentCreation()">Cancel</button>
    </div>
  </script>
</div>

<!-- timeline: message edition modal -->
<div>
  <script type="text/ng-template" id="modal_editMessage.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelMessageEdition()">×</button>
      <h4 class="modal-title">Message edition</h4>
    </div>
    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="form-group {[{ error.title ? 'has-error' : '' }]}">
            <label for="message-edited-title" class="col-md-1 control-label">Title</label>
            <div class="col-md-11">
              <input type="text" class="form-control" id="message-edited-title" data-ng-model="new.message.title" placeholder="Title">
            </div>
          </div>
          <div class="form-group {[{ error.content ? 'has-error' : '' }]}">
            <label for="message-edited-content" class="col-md-1 control-label">Message</label>
            <div class="col-md-11">
              <textarea class="form-control" rows="3" id="message-edited-content" data-ng-model="new.message.message" placeholder="Message"></textarea>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmMessageEdition()">Update</button>
      <button type="button" class="btn" data-ng-click="modal_cancelMessageEdition()">Cancel</button>
    </div>
  </script>
</div>

<!-- timeline: comment edition modal -->
<div>
  <script type="text/ng-template" id="modal_editComment.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelCommentEdition()">×</button>
      <h4 class="modal-title">Comment edition</h4>
    </div>
    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="form-group {[{ error.content ? 'has-error' : '' }]}">
            <label for="comment-edited-content" class="col-md-1 control-label">Message</label>
            <div class="col-md-11">
              <textarea class="form-control" rows="3" id="comment-edited-content" data-ng-model="new.comment" placeholder="Comment"></textarea>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmCommentEdition()">Update</button>
      <button type="button" class="btn" data-ng-click="modal_cancelCommentEdition()">Cancel</button>
    </div>
  </script>
</div>

<!-- timeline: message deletion modal -->
<div>
  <script type="text/ng-template" id="modal_deleteMessage.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelMessageDeletion()">×</button>
      <h4 class="modal-title">Message deletion</h4>
    </div>
    <div class="modal-body">
    <p>Are you sure you want to delete this message?</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmMessageDeletion()">Yes</button>
      <button type="button" class="btn" data-ng-click="modal_cancelMessageDeletion()">No</button>
    </div>
  </script>
</div>

<!-- timeline: comment deletion modal -->
<div>
  <script type="text/ng-template" id="modal_deleteComment.html">
    <div class="modal-header">
      <button type="button" class="close" aria-hidden="true" data-ng-click="modal_cancelCommentDeletion()">×</button>
      <h4 class="modal-title">Comment deletion</h4>
    </div>
    <div class="modal-body">
    <p>Are you sure you want to delete this comment?</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-ng-click="modal_confirmCommentDeletion()">Yes</button>
      <button type="button" class="btn" data-ng-click="modal_cancelCommentDeletion()">No</button>
    </div>
  </script>
</div>