<!-- This file is subject to the terms and conditions defined in file 'LICENSE.txt',
which is part of the GRAPPBOX source code package.
COPYRIGHT GRAPPBOX. ALL RIGHTS RESERVED. -->

<div class="view view-content" id="project-content-view" data-ng-controller="projectController">

    <uib-alert ng-repeat="alert in alertList" type="{[{ alert.type }]}">{[{ alert.message }]}</uib-alert>

    <section class="app-section" id="project-content">
        <div class="container app-container">
          <div class="row">
            <div ng-if="data.project_new" class="section-heading app-section-heading">
              <h2>New project: {[{data.project.name}]}</h2>
              <p></p>
            </div>
            <div data-ng-if="!data.project_new && !data.project_error" class="section-heading app-section-heading">
              <h2>{[{data.project.name + " settings"}]}</h2>
              <div data-ng-if="!data.onLoad">
                <div class="row">
                  <p>Created at {[{ formatObjectDate(data.project.creation_date.date) }]}</p>
                </div>
                <div class="row">
                  <p data-ng-if="data.project.deleted_at">Deleted at {[{ formatObjecctDate(data.project.deleted_at.data) }]}</p>
                  <p>
                    <a ng-if="!data.project.deleted_at && data.canEdit" href="" ng-click="deleteProject()" class="btn-default btn-access"><i class="fa fa-times"></i>Delete</a>
                    <a ng-if="data.project.deleted_at && data.canEdit" href="" ng-click="retrieveProject()" class="btn-default btn-access"><i class="fa fa-undo"></i>Retrieve</a>
                  </p>
                </div>
              </div>
            </div>
          </div>
            <div class="row">
                <div class="col-lg-12">
                  <!-- grappbox.data : project content -->
                  <div  data-ng-if="data.project_new">
                    <div data-ng-if="data.onLoad">
                      <div class="section-heading app-section-heading"><h2></h2></div>
                      <div class="section-content app-section-content">
                        <div class="loading-content section">
                          <div></div>
                        </div>
                      </div>
                    </div><!-- data-ng-if="data.onLoad" -->
                    <div data-ng-if="!data.onLoad">
                      <div class="col-lg-6">
                        <div class="section-heading app-section-heading"><h2>General informations</h2></div>
                        <div class="section-content app-section-content">
                            <form novalidate>
                              <div class="form-group">
                                <div ng-if="data.project.logo">
                                  <img class="shadow" data-ng-src="data:image/png;base64,{[{ data.project.logo }]}" data-err-src="../resources/images/default-logo.min.png" height="120" width="120">
                                </div>
                                <div ng-if="!data.project.logo">
                                  <img class="shadow" data-ng-src="../resources/images/default-logo.min.png" height="120" width="120">
                                </div>
                                <input class="form-control" type="file" ng-model="data.project.logo">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Name</h4>
                                <input type="text" class="form-control" ng-model="data.project.name">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Description</h4>
                                <textarea class="form-control" ng-model="data.project.description"></textarea>
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Company</h4>
                                <input type="text" class="form-control" ng-model="data.project.company">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Phone</h4>
                                <input type="phone" class="form-control" ng-model="data.project.phone">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Email</h4>
                                <input type="email" class="form-control" ng-model="data.project.contact_mail">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Facebook</h4>
                                <input type="url" class="form-control" ng-model="data.project.facebook">
                              </div><!-- !form-group -->
                              <div class="form-group">
                                <h4>Twitter</h4>
                                <input type="url" class="form-control" ng-model="data.project.twitter">
                              </div><!-- !form-group -->
                              <!-- TODO password mandatory ? generate if not provide ? -->
                              <div class="form-group">
                                <h4>Password</h4>
                                <p>Used for the cloud</p>
                                <input type="password" class="form-control" ng-model="data.project.password">
                              </div><!-- !form-group -->
                              <div>
                                <p><a class="btn-default button save-button" href="" ng-click="createProject(data.project)"><i class="fa fa-check"></i>Create</a></p>
                              </div>
                            </form>
                        </div><!-- !section-content -->
                      </div>
                      <div class="col-lg-6">
                        <div class="row">
                          <div class="section-heading app-section-heading">
                            <h2>Participants</h2>
                          </div>
                          <div class="section-content app-section-content">
                            <p>

                            </p>
                          </div><!-- !section-content -->
                        </div><!-- !row -->
                        <div class="row">
                          <div class="section-heading app-section-heading">
                            <h2>Customers Access</h2>
                          </div>
                          <div class="section-content app-section-content">
                            <p>

                            </p>
                          </div><!-- !section-content -->
                        </div><!-- !row -->
                      </div><!-- !col-lg-6 -->
                    </div><!-- ! data-ng-if="!data.onLoad"-->
                  </div><!-- ! ng-if="!data.project_new" -->

                  <div class="" ng-if="!data.project_new">

                    <div id="tab-pannel">
                      <!-- Nav tabs -->
                        <ul class="nav nav-tabs" role="tablist">
                          <li id="general-title" role="presentation" class="active"><a href="" role="tab" data-toggle="tab" ng-click="displayTab('#general-content')">General</a></li>
                          <li id="users-title" role="presentation"><a href="" role="tab" data-toggle="tab" ng-click="displayTab('#users-content')">Users</a></li>
                          <li id="roles-title" role="presentation"><a href="" role="tab" data-toggle="tab" ng-click="displayTab('#roles-content')">Roles</a></li>
                          <li id="customers-title" role="presentation"><a href="" role="tab" data-toggle="tab" ng-click="displayTab('#customers-content')">Customers Acccess</a></li>
                        </ul>

                      <!-- Tab panes -->
                      <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="general-content">
                          <div data-ng-if="data.onLoad">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="loading-content section">
                                <div></div>
                              </div>
                            </div>
                          </div>
                          <div data-ng-if="(!data.onLoad && !data.project_error)">
                              <div class="section-heading app-section-heading">
                                <h2>General informations</h2>
                              </div>
                              <div class="section-content app-section-content">
                                <form novalidate>
                                  <div class="form-group">
                                    <div ng-if="data.project.logo">
                                      <img class="shadow" data-ng-src="data:image/png;base64,{[{ data.project.logo }]}" data-err-src="../resources/images/default-logo.min.png" height="120" width="120">
                                    </div>
                                    <div ng-if="!data.project.logo">
                                      <img class="shadow" data-ng-src="../resources/images/default-logo.min.png" height="120" width="120">
                                    </div>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" class="form-control" type="file" ng-model="data.project.logo">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Name</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="text" class="form-control" ng-model="data.project.name">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Description</h4>
                                    <textarea ng-disabled="!data.editMode || data.project.deleted_at" class="form-control" ng-model="data.project.description"></textarea>
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Company</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="text" class="form-control" ng-model="data.project.company">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Phone</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="phone" class="form-control" ng-model="data.project.phone">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Email</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="email" class="form-control" ng-model="data.project.contact_mail">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Facebook</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="url" class="form-control" ng-model="data.project.facebook">
                                  </div><!-- !form-group -->
                                  <div class="form-group">
                                    <h4>Twitter</h4>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" type="url" class="form-control" ng-model="data.project.twitter">
                                  </div><!-- !form-group -->
                                  <div class="form-group" ng-if="data.canEdit">
                                    <h4>Password</h4>
                                    <p>Used for the cloud</p>
                                    <label for="old_pswd">Actual password</label>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" id="old_pswd" type="password" class="form-control" ng-model="data.project.old_password">
                                    <label for="new_pswd">New password</label>
                                    <input ng-disabled="!data.editMode || data.project.deleted_at" id="new_pswd" type="password" class="form-control" ng-model="data.project.new_password">
                                  </div><!-- !form-group -->
                                  <div class-"form-group" ng-if="!data.project.deleted_at && data.canEdit" ng-switch="data.editMode">
                                      <div ng-switch-default >
                                        <p><a href="" class="btn-default btn-access" ng-click="project_switchEditMode()"><i class="fa fa-pencil-square-o"></i>Edit</a></p>
                                      </div>
                                      <div ng-switch-when="true">
                                        <p><a class="btn-default button cancel-button" href="" ng-click="project_switchEditMode()"><i class=" fa fa-close"></i>Cancel</a>
                                        <a class="btn-default button save-button" href="" ng-click="updateProject(data.project)"><i class="fa fa-check"></i>Save</a></p>
                                      </div>
                                  </div><!-- ng-switch -->
                                </form>
                              </div><!-- !section-content -->
                          </div><!-- !data-ng-if="data.onLoad && !data.project_error" -->
                          <div data-ng-if="data.project_error">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="app-data error">
                                  <p><i class="fa fa-times"></i>An error has occurred. Please try again.</p>
                              </div>
                            </div>
                          </div>
                        </div><!-- ! #general-content-->

                        <div role="tabpanel" class="tab-pane" id="users-content">
                          <div data-ng-if="data.usersLoad">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="loading-content section">
                                <div></div>
                              </div>
                            </div>
                          </div>
                          <div data-ng-if="(!data.usersLoad && !data.users_error)" id="users-list">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="data-wrapper">
                                <form class="form-inline" novalidate>
                                  <label for="newUser">Enter the user's email:</label>
                                  <input class="form-control" type="email" name="newUser" ng-model="new_user">
                                  <button type="submit" class="btn btn-default" ng-click="addUser(new_user)"><i class="fa fa-plus"></i>Add</button>
                                </form>
                              </div>
                              <div class="data-wrapper" ng-repeat="user in data.users">
                                  <ul class="data-content shadow">
                                      <li>
                                        <span class="title">{[{user.firstname + " " + user.lastname}]}</span>
                                      </li>
                                  </ul>
                                  <div class="">
                                    <form class="form-inline" novalidate>
                                      <div class="form-group">
                                        <label for="role">Role</label>
                                        <select class="form-control" name="role" ng-model="user.role" ng-options="role.id as role.name for role in data.roles"></select>
                                      </div>
                                      <button type="submit" class="btn btn-default" ng-click="assignRoleToUser(user)"><i class="fa fa-floppy-o"></i>Save change</button>
                                      <button type="button" class="btn btn-default" ng-click="removeUser(user)"><i class="fa fa-times"></i>Remove</button>
                                    </form>
                                  </div>
                              </div>
                            </div><!-- !section-content -->
                          </div><!-- !data-ng-if="data.onLoad && !data.users_error" -->
                          <div data-ng-if="data.users_error">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="app-data error">
                                  <p><i class="fa fa-times"></i>An error has occurred. Please try again.</p>
                              </div>
                            </div>
                          </div><!-- !data-ng-if="data.users_erroe-->
                        </div><!-- ! #users-content-->

                        <div role="tabpanel" class="tab-pane" id="roles-content">
                          <div data-ng-if="data.rolesLoad">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="loading-content section">
                                <div></div>
                              </div>
                            </div>
                          </div>
                          <div data-ng-if="(!data.rolesLoad && !data.roles_error)" id="roles-list">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="data-wrapper"><!-- new role -->
                                <ul class="data-content shadow">
                                    <li>
                                      <span class="title">New Role</span>
                                    </li>
                                </ul>
                                <div class="roles-details">
                                  <form class="form-inline" novalidate>
                                    <div class="form-group">
                                      <label for="name">Name</label>
                                      <input class="form-control" type="text" name="name" ng-model="new_role.name">
                                    </div>
                                    <div class="form-group">
                                      <label for="team-timeline">Team Timeline</label>
                                      <select name="team-timeline" class="form-control" ng-model="new_role.team_timeline" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="customer-timeline">Customer Timeline</label>
                                      <select name="customer-timeline" class="form-control" ng-model="new_role.customer_timeline" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="gantt">Gantt</label>
                                      <select name="gantt" class="form-control" ng-model="new_role.gantt" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="whiteboard">Whiteboard</label>
                                      <select name="whiteboard" class="form-control" ng-model="new_role.whiteboard" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="bugtracker">Bugtracker</label>
                                      <select name="bugtracker" class="form-control" ng-model="new_role.bugtracker" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="event">Event</label>
                                      <select name="event" class="form-control" ng-model="new_role.event" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="task">Task</label>
                                      <select name="task" class="form-control" ng-model="new_role.task" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="project-settings">Project Settings</label>
                                      <select name="project-settings" class="form-control" ng-model="new_role.project_settings" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="cloud">Cloud</label>
                                      <select name="cloud" class="form-control" ng-model="new_role.cloud" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <button type="submit" class="btn btn-default" ng-click="createRole(new_role)"><i class="fa fa-plus"></i>Create</button>
                                  </form>
                                </div><!-- !#roles-details -->
                              </div><!-- !new role -->
                              <div class="data-wrapper" ng-repeat="role in data.roles">
                                <ul class="data-content shadow">
                                    <li>
                                      <span class="title">{[{role.name}]}</span>
                                    </li>
                                </ul>
                                <div class="roles-details">
                                  <form class="form-inline" novalidate>
                                    <div class="form-group">
                                      <label for="team-timeline">Team Timeline</label>
                                      <select name="team-timeline" class="form-control" ng-model="role.team_timeline" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="customer-timeline">Customer Timeline</label>
                                      <select name="customer-timeline" class="form-control" ng-model="role.customer_timeline" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="gantt">Gantt</label>
                                      <select name="gantt" class="form-control" ng-model="role.gantt" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="whiteboard">Whiteboard</label>
                                      <select name="whiteboard" class="form-control" ng-model="role.whiteboard" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="bugtracker">Bugtracker</label>
                                      <select name="bugtracker" class="form-control" ng-model="role.bugtracker" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="event">Event</label>
                                      <select name="event" class="form-control" ng-model="role.event" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="task">Task</label>
                                      <select name="task" class="form-control" ng-model="role.task" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="project-settings">Project Settings</label>
                                      <select name="project-settings" class="form-control" ng-model="role.project_settings" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <div class="form-group">
                                      <label for="cloud">Cloud</label>
                                      <select name="cloud" class="form-control" ng-model="role.cloud" ng-options="convertToInt(right.id) as right.name for right in rightsOptions"></select>
                                    </div>
                                    <button type="submit" class="btn btn-default" ng-click="editRole(role)"><i class="fa fa-floppy-o"></i>Save changes</button>
                                    <button type="button" class="btn btn-default" ng-click="deleteRole(role)"><i class="fa fa-trash"></i>Delete</button>
                                  </form>
                                </div><!-- !#roles-details -->
                              </div><!-- !ng-repeat="role in data.roles"-->
                            </div><!-- !section-content -->
                          </div><!-- !data-ng-if="data.onLoad && !data.project_error" -->
                          <div data-ng-if="data.roles_error">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="app-data error">
                                  <p><i class="fa fa-times"></i>An error has occurred. Please try again.</p>
                              </div>
                            </div>
                          </div>
                        </div><!-- ! #roles-content-->

                        <div role="tabpanel" class="tab-pane" id="customers-content">
                          <div data-ng-if="data.customersLoad">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="loading-content section">
                                <div></div>
                              </div>
                            </div>
                          </div>
                          <div data-ng-if="(!data.customersLoad && !data.customers_error)" id="customers-list">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                                <div class="data-wrapper">
                                  <ul class="data-content shadow">
                                    <li><span class="title">New Customer Access</span></li>
                                  </ul>
                                  <div class="">
                                    <form class="form-inline" novalidate>
                                      <div class="form-group">
                                          <label for="name">Name</label>
                                          <input class="form-control" type="text" name="name" ng-model="new_customer.name">
                                      </div>
                                      <button type="submit"class="btn btn-default" ng-click="createCustomersAccess(new_customer)"><i class="fa fa-plus"></i>Create</button>
                                    </form>
                                  </div>
                                </div>
                                <div class="data-wrapper" ng-repeat="customer in data.customers">
                                    <ul class="data-content shadow">
                                        <li>
                                          <span class="title">{[{customer.name}]}</span>
                                        </li>
                                        <li>
                                          <span>Token: {[{customer.customer_token}]}</span>
                                        </li>
                                    </ul>
                                    <a href="" class="btn btn-default" ng-click="deleteCustomerAccess(customer)"><i class="fa fa-trash-o"></i>Supprimer</a>
                                </div>
                            </div><!-- !section-content -->
                          </div><!-- !data-ng-if="data.onLoad && !data.project_error" -->
                          <div data-ng-if="data.customers_error">
                            <div class="section-heading app-section-heading"><h2></h2></div>
                            <div class="section-content app-section-content">
                              <div class="app-data error">
                                  <p><i class="fa fa-times"></i>An error has occurred. Please try again.</p>
                              </div>
                            </div>
                          </div>
                        </div><!-- ! #customers-content-->
                      </div>
                    </div>

                  </div><!-- ! ng-if="data.project_new"-->
                </div><!-- !col-lg-12 -->
            </div><!-- row -->
        </div><!-- container app-container-->
    </section>

</div><!-- !project-content-view -->
