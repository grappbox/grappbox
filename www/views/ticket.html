<!--
    Summary: Ticket view
-->

<ion-view>
    <ion-nav-title>Ticket</ion-nav-title>
    <ion-content overflow-scroll="false">

        <!-- Refresher -->
        <ion-refresher pulling-text="Pull to refresh..."
                       on-refresh="doRefresh()">
        </ion-refresher>

        <div class="item item-divider">Ticket</div>

        <div class="item item-body">
            <!-- Ticket's title -->
            <h2>{{ticket.title}}</h2>

            <!-- Tags on ticket -->
            <button ng-repeat="tag in ticket.tags" class="button button-small button-balanced">{{ tag.name }}</button><br />

            <!-- Users on ticket -->
            <button ng-repeat="user in ticket.users" class="button button-small button-calm">{{ user.name }}</button><br /><br />

            <!-- Ticket's description, creator's name -->
            <textarea ng-readonly="true"
                      rows="5"
                      ng-model="ticket.description"></textarea>
            <p>
                By {{ticket.creator.fullname}}<br />
                Created: {{ticket.createdAt.date}}<br />
                <span ng-show="ticket.editedAt">Edited: {{ticket.editedAt.date}}</span>
            </p>
            <a ng-show="ticket.creator.id == userConnectedId" class="button button-block button-positive"
               ui-sref="app.editTicket({projectId: projectId, ticketId: ticketId})">
                Edit
            </a>
        </div>

            <!-- Comments on ticket-->
            <div class="item item-divider">Comments</div>
            <ion-item ng-repeat="com in comments">
                <textarea rows="5"
                          ng-readonly="com.creator.id != userConnectedId"
                          ng-model="com.description"></textarea>
                <p>By {{com.creator.fullname}}</p>
                <div class="button-bar" ng-show="com.creator.id == userConnectedId">
                    <a class="button button-block icon ion-ios-trash button-small button-assertive"
                       ng-click="CloseComment(com)">
                    </a>
                    <a class="button button-block icon ion-edit button-small button-positive"
                       ng-click="EditCommentOnTicket(com)">
                    </a>
                </div>
            </ion-item>

        <!-- No comment error -->
        <p ng-show="comments[0] == null">There is no comment.</p>
        <div class="item item-divider">Comment on issue</div>

        <!-- Commenting form -->
        <form name="comment_form">
            <!-- Comment's description -->
            <ion-item>
                <textarea name="comment_description"
                          rows="5"
                          placeholder="Leave a comment"
                          ng-model="comment.description"></textarea>
            </ion-item>
            <div class="button-bar">
                <!-- If ticket is open & Comment is empty -->
                <a ng-show="ticket.deletedAt == null && comment.description == null"
                   class="button button-block button-assertive"
                   ng-click="CloseTicket()">
                    Close issue
                </a>
                <!-- If ticket is open & Comment isn't empty -->
                <a ng-show="ticket.deletedAt == null && comment.description != null"
                   class="button button-block button-assertive"
                   ng-click="CloseTicketAndComment()">
                    Close and comment
                </a>
                <!-- If ticket is closed & Comment is empty -->
                <a ng-show="ticket.deletedAt != null && comment.description == null"
                   class="button button-block button-assertive"
                   ng-click="ReopenTicket()">
                    Reopen issue
                </a>
                <!-- If ticket is closed & Comment isn't empty -->
                <a ng-show="ticket.deletedAt != null && comment.description != null"
                   class="button button-block button-assertive"
                   ng-click="ReopenTicketAndComment()">
                    Reopen and comment
                </a>
                <!-- Comment button -->
                <a class="button button-block button-positive"
                   ng-click="PostComment()">
                    Comment
                </a>
            </div>
        </form>
    </ion-content>
</ion-view>