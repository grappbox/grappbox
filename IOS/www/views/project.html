<!--
    Summary: Single project view
-->

<ion-view>
    <ion-nav-title>Project</ion-nav-title>
    <ion-content overflow-scroll="false">
        <!-- Refresher -->
        <ion-refresher pulling-text="Pull to refresh..."
                       on-refresh="doRefresh()">
        </ion-refresher>

        <!-- Project information -->
        <div class="item item-divider">Project information</div>
        <ion-list class="card">
            <ion-item class="item-body">
                <!--<img class="full-image" data-ng-src="data:image/png;base64, {{projectInfo.logo}}" />-->
                <!--<img class="full-image" ng-src="data:image/png;base64, {{ projectLogo.logo ? projectLogo.logo : './images/noproject.png' }}" />-->
                <img ng-if="projectLogo.logo" id="projectLogo" ng-src="data:image/png;base64, {{projectLogo.logo}}" style="width: 140px; height: 140px; display:block; margin-left: auto; margin-right: auto;" />
                <img ng-if="!projectLogo.logo" id="projectLogo" ng-src="./images/noproject.png" style="width: 140px; height: 140px; display:block; margin-left: auto; margin-right: auto;" />
                <p ng-show="projectInfo.name"><strong>Name: </strong> {{ projectInfo.name }}</p>
                <p ng-show="projectInfo.description"><strong>Description: </strong> {{ projectInfo.description }}</p>
                <p ng-show="projectInfo.phone"><strong>Phone: </strong> {{ projectInfo.phone }}</p>
                <p ng-show="projectInfo.company"><strong>Company: </strong> {{ projectInfo.company }}</p>
                <p ng-show="projectInfo.contact_mail"><strong>Email: </strong> {{ projectInfo.contact_mail }}</p>
                <p ng-show="projectInfo.creation_date.date"><strong>Creation date: </strong> {{ projectInfo.creation_date.date }}</p>
                <p ng-show="projectInfo.facebook"><strong>Facebook: </strong> {{ projectInfo.facebook }}</p>
                <p ng-show="projectInfo.twitter"><strong>Twitter: </strong> {{ projectInfo.twitter }}</p>
                <p ng-show="projectInfo.deleted_at != null"><strong style="color:red">IN DELETION :(</strong></p>

                <!-- Edit project button -->
                <button class="button button-block icon ion-edit button-positive"
                   ui-sref="app.editProject({projectId: projectId})">
                </button>
            </ion-item>
        </ion-list>
        <!-- Users on project -->
        <div class="item item-divider">Members</div>
        <ion-list can-swipe="true">
            <ion-item ng-show="noUser">{{noUser}}</ion-item>
            <ion-item ng-show="!noUser"
                      class="item-avatar"
                      ng-repeat="userOnProject in userList"
                      ui-sref="app.user({ userId: userOnProject.id, projectId: projectId })"><!--ng-click="showMemberActionSheet(userOnProject.id)"-->
                <img ng-if="findUserAvatar(userOnProject.id)" id="userAvatar" ng-src="data:image/png;base64, {{findUserAvatar(userOnProject.id)}}" style="width: 140px; height: 140px; display:block; margin-left: auto; margin-right: auto;" />
                <img ng-if="!findUserAvatar(userOnProject.id)" id="userAvatar" ng-src="./images/noavatar.png" style="width: 140px; height: 140px; display:block; margin-left: auto; margin-right: auto;" />

                <h2>{{ userOnProject.firstname }} {{ userOnProject.lastname }}</h2>
                <ion-option-button class="button-assertive ion-ios-trash"
                                   ng-click="PopupRemoveUserFromProject(userOnProject.id)">
                </ion-option-button>
            </ion-item>
        </ion-list>

        <!-- Add a user -->
        <form name="add_user_form">
            <ion-item class="item-input-inset">
                <label class="item-input-wrapper">
                    <input type="email" placeholder="User email"
                           name="userToAdd_email" ng-model="userToAdd.userEmail" required>
                </label>
                <button ng-disabled="add_user_form.$invalid"
                        class="button button-small button-positive icon ion-plus"
                        ng-click="AddUserToProject()">
                </button>
            </ion-item>
        </form>

        <!-- Roles on project -->
        <div class="item item-divider">Roles</div>
        <ion-list can-swipe="true">
            <ion-item ng-show="noRole">{{noRole}}</ion-item>
            <ion-item ng-show="!noRole"
                      ng-repeat="role in projectRoles"
                      ui-sref="app.role({projectId: projectId, roleId: role.roleId, role: role})">
                <h2>{{ role.name }}</h2>
                <ion-option-button class="button-assertive icon ion-ios-trash"
                                   ng-click="PopupDeleteRoleFromProject(role.roleId)">
                </ion-option-button>
            </ion-item>
        </ion-list>

        <!-- Add a role on project -->
        <form>
            <ion-item class="item-input-inset">
                <button class="button button-block button-positive icon ion-plus"
                        ui-sref="app.createRole({projectId: projectId})">
                </button>
            </ion-item>
        </form>


        <!-- Customers accesses on project -->
        <div class="item item-divider">Customers Accesses</div>
        <ion-list can-swipe="true">
            <ion-item ng-show="noCustomer">{{noCustomer}}</ion-item>
            <ion-item ng-show="!noCustomer"
                      class="item item-text-wrap"
                      ng-repeat="customerOnProject in customersList"><!--ng-click="showCustomerActionSheet(customerOnProject.id, customerOnProject.name)"-->
                <!--<img ng-src="" />-->
                <h2>{{ customerOnProject.name }}</h2>
                <!--<p><strong>Created: </strong>{{ customerOnProject.creation_date.date }}</p>-->
                <p><strong>Token: </strong>{{ customerOnProject.token }}</p>
                <ion-option-button class="button-assertive icon ion-ios-refresh"
                                   ng-click="DeleteCustomerAccessBeforeRegen(customerOnProject.id, customerOnProject.name)">
                </ion-option-button>
                <ion-option-button class="button-assertive icon ion-ios-trash"
                                   ng-click="PopupDeleteCustomerAccess(customerOnProject.id)">
                </ion-option-button>
            </ion-item>
        </ion-list>

        <!-- Generate a link for customer -->
        <form name="gen_access_form">
            <ion-item class="item-input-inset">
                <label class="item-input-wrapper">
                    <input type="text" placeholder="Customer access name"
                           name="customerAccessToAdd_email" ng-model="customerAccessToAdd.accessName" required />
                </label>
                <button ng-disabled="gen_access_form.$invalid"
                        class="button button-small button-positive icon ion-link"
                        ng-click="GenerateAccess()">
                </button>
            </ion-item>
        </form>

        <!-- Danger zone -->
        <div class="item item-divider bar bar-assertive">Danger zone</div>
        <a ng-show="projectInfo.deleted_at == null" class="button button-block button-dark icon ion-ios-trash"
           ng-click="PopupDeleteProject()">
        </a>
        <a ng-show="projectInfo.deleted_at != null" class="button button-block button-dark"
           ng-click="RetreiveProject()">
            Retreive this project
        </a>
    </ion-content>
</ion-view>